{"ast":null,"code":"import axios from 'axios';\nconst baseURL = 'http://localhost:1010';\nconst axiosInstance = axios.create({\n  baseURL: baseURL,\n  timeout: 5000,\n  headers: {\n    Authorization: localStorage.getItem('access_token') ? 'JWT ' + localStorage.getItem('access_token') : null,\n    'Content-Type': 'application/json',\n    accept: 'application/json'\n  }\n});\naxiosInstance.interceptors.response.use(response => {\n  var sss = \"http://localhost:1010\";\n  console.log(sss.toString());\n  return response;\n}, async function (error) {\n  const originalRequest = error.config;\n\n  //if (typeof error.response === 'undefined') {\n  //\talert(\n  //\t\t'A server/network error occurred. ' +\n  ///\t\t\t'Looks like CORS might be the problem. ' +\n  //\t\t\t'Sorry about this - we will get it fixed shortly.'\n  //\t);\n  //\treturn Promise.reject(error);\n  //}\n\n  if (error.response.status === 401 && originalRequest.url === baseURL + '/refresh/token') {\n    window.location.href = '/';\n    return Promise.reject(error);\n  }\n  if (error.response.data.code === 'token_not_valid' && error.response.status === 401 && error.response.statusText === 'Unauthorized') {\n    const refreshToken = localStorage.getItem('refresh_token');\n    const acessToken = localStorage.getItem('access_token');\n    if (refreshToken) {\n      const tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\n      const now = Math.ceil(Date.now() / 1000);\n      console.log(tokenParts.exp);\n      if (tokenParts.exp > now) {\n        return axiosInstance.post('/refresh/token', {\n          RefreshToken: refreshToken,\n          AcessToken: acessToken\n        }).then(response => {\n          localStorage.setItem('access_token', response.data.AccessToken);\n          localStorage.setItem('refresh_token', response.data.RefreshToken);\n          axiosInstance.defaults.headers['Authorization'] = 'JWT ' + response.data.access;\n          originalRequest.headers['Authorization'] = 'JWT ' + response.data.access;\n          return axiosInstance(originalRequest);\n        }).catch(err => {\n          console.log(err);\n        });\n      } else {\n        console.log('Refresh token is expired', tokenParts.exp, now);\n        window.location.href = '/LoginForm';\n      }\n    } else {\n      console.log('Refresh token not available.');\n      window.location.href = '/LoginForm';\n    }\n  }\n\n  // specific error handling done elsewhere\n  return Promise.reject(error);\n});\nexport default axiosInstance;","map":{"version":3,"names":["axios","baseURL","axiosInstance","create","timeout","headers","Authorization","localStorage","getItem","accept","interceptors","response","use","sss","console","log","toString","error","originalRequest","config","status","url","window","location","href","Promise","reject","data","code","statusText","refreshToken","acessToken","tokenParts","JSON","parse","atob","split","now","Math","ceil","Date","exp","post","RefreshToken","AcessToken","then","setItem","AccessToken","defaults","access","catch","err"],"sources":["C:/Users/ZAITER/Downloads/REACT/react101/src/axios.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst baseURL = 'http://localhost:1010';\r\n\r\n\r\n\r\nconst axiosInstance = axios.create({\r\n    baseURL: baseURL,\r\n    timeout: 5000,\r\n    headers: {\r\n        Authorization: localStorage.getItem('access_token')\r\n            ? 'JWT ' + localStorage.getItem('access_token')\r\n            : null,\r\n        'Content-Type': 'application/json',\r\n        accept: 'application/json',\r\n    },\r\n});\r\n\r\naxiosInstance.interceptors.response.use(\r\n\t(response) => {\r\n\t\tvar sss = \"http://localhost:1010\"\r\n\t\tconsole.log(sss.toString())\r\n\t\treturn response;\r\n\t},\r\n\tasync function (error) {\r\n\t\tconst originalRequest = error.config;\r\n\r\n\t\t//if (typeof error.response === 'undefined') {\r\n\t\t//\talert(\r\n\t\t//\t\t'A server/network error occurred. ' +\r\n\t\t///\t\t\t'Looks like CORS might be the problem. ' +\r\n\t\t//\t\t\t'Sorry about this - we will get it fixed shortly.'\r\n\t\t//\t);\r\n\t\t//\treturn Promise.reject(error);\r\n\t\t//}\r\n\r\n\t\tif (\r\n\t\t\terror.response.status === 401 &&\r\n\t\t\toriginalRequest.url === baseURL + '/refresh/token'\r\n\t\t) {\r\n\t\t\twindow.location.href = '/';\r\n\t\t\treturn Promise.reject(error);\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\terror.response.data.code === 'token_not_valid' &&\r\n\t\t\terror.response.status === 401 &&\r\n\t\t\terror.response.statusText === 'Unauthorized'\r\n\t\t) {\r\n\t\t\tconst refreshToken = localStorage.getItem('refresh_token');\r\n            const acessToken = localStorage.getItem('access_token');\r\n\r\n\t\t\tif (refreshToken) {\r\n\t\t\t\tconst tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\r\n\r\n\t\t\t\tconst now = Math.ceil(Date.now() / 1000);\r\n\t\t\t\tconsole.log(tokenParts.exp);\r\n\r\n\t\t\t\tif (tokenParts.exp > now) {\r\n\t\t\t\t\treturn axiosInstance\r\n\t\t\t\t\t\t.post('/refresh/token', { RefreshToken: refreshToken,AcessToken: acessToken })\r\n\t\t\t\t\t\t.then((response) => {\r\n\t\t\t\t\t\t\tlocalStorage.setItem('access_token', response.data.AccessToken);\r\n\t\t\t\t\t\t\tlocalStorage.setItem('refresh_token', response.data.RefreshToken);\r\n\r\n\t\t\t\t\t\t\taxiosInstance.defaults.headers['Authorization'] =\r\n\t\t\t\t\t\t\t\t'JWT ' + response.data.access;\r\n\t\t\t\t\t\t\toriginalRequest.headers['Authorization'] =\r\n\t\t\t\t\t\t\t\t'JWT ' + response.data.access;\r\n\r\n\t\t\t\t\t\t\treturn axiosInstance(originalRequest);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch((err) => {\r\n\t\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('Refresh token is expired', tokenParts.exp, now);\r\n\t\t\t\t\twindow.location.href = '/LoginForm';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log('Refresh token not available.');\r\n\t\t\t\twindow.location.href = '/LoginForm';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// specific error handling done elsewhere\r\n\t\treturn Promise.reject(error);\r\n\t}\r\n);\r\n\r\n\r\nexport default axiosInstance;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}